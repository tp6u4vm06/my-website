<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>易居房EG City｜首頁/買屋/比價/實價登錄</title>
  <style>
    :root{
      --bg:#1a1a1a; --card:#242424; --border:#3a3a3a;
      --text-main:#f0f0f0; --text-muted:#b2b2b2;
      --blue:#c0c0c0; --blue-dark:#9a9a9a; --blue-light:#202020;
      --shadow:0 6px 18px rgba(0,0,0,.35);
      font-family: "Noto Sans TC","Helvetica Neue",Arial,sans-serif;
    }
    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(180deg,var(--blue-light) 0%,var(--bg) 80%);color:var(--text-main);min-height:100vh;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}
    .nav{display:flex;align-items:center;justify-content:space-between;padding:14px 20px;background:rgba(18,18,18,.85);backdrop-filter:blur(8px);box-shadow:var(--shadow);position:sticky;top:0;z-index:10}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:42px;height:42px;border-radius:8px;background:var(--blue);display:flex;align-items:center;justify-content:center;color:#121212;font-weight:700;font-size:18px;box-shadow:0 4px 10px rgba(0,0,0,.35)}
    .logo img{height:48px;display:block;border-radius:12px}
    .nav-links{display:flex;gap:10px;align-items:center}
    .nav-links a{color:#f0f0f0;text-decoration:none;font-weight:700;font-size:14px;padding:8px 10px;border-radius:8px}
    .nav-links a.active,.nav-links a:hover{background:#c0c0c0;color:#121212}
    .container{max-width:1200px;margin:24px auto;padding:0 12px 80px}
    .section-title{margin:8px 0 14px 4px;font-weight:800;color:#f5f5f5}
    .hero{position:relative;max-width:1200px;margin:24px auto;border-radius:16px;color:#fff;box-shadow:var(--shadow);background:#202020}
    .hero-inner{position:relative;padding:48px 24px;max-width:800px;display:flex;flex-direction:column;gap:14px}
    .hero h1{margin:0;font-size:40px;line-height:1.1}
    .hero p{margin:0;font-size:17px;opacity:.95}
    .cta{margin-top:16px;display:inline-block;font-size:14px;padding:8px 14px;border-radius:8px;background:#c0c0c0;color:#121212;text-decoration:none;font-weight:700;box-shadow:0 6px 14px rgba(0,0,0,.25)}
    .controls{max-width:1200px;margin:24px auto;padding:20px;background:#1f1f1f;border-radius:12px;display:flex;gap:12px;align-items:center;flex-wrap:wrap;box-shadow:var(--shadow)}
    .controls .field{display:flex;flex-direction:column;gap:6px}
    label{font-size:13px;color:#d0d0d0}
    input[type="text"],input[type="number"],input[type="month"],select{background:#151515;color:var(--text-main);padding:10px 12px;border-radius:8px;border:1px solid var(--border);min-width:160px;outline:none}
    input:focus,select:focus{border-color:var(--blue);box-shadow:0 0 0 3px rgba(192,192,192,.25)}
    .range-inline{display:flex;gap:8px;align-items:center}
    .btns{margin-left:auto;display:flex;gap:8px}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:20px}
    .card{background:var(--card);color:var(--text-main);border-radius:12px;overflow:hidden;box-shadow:var(--shadow);display:flex;flex-direction:column}
    .card .content{padding:12px;display:flex;flex-direction:column;gap:10px;flex:1}
    .meta{display:flex;justify-content:space-between;align-items:center}
    .price{font-weight:800;color:var(--blue)}
    .tags,.desc{color:var(--text-muted)}
    .actions{display:flex;gap:8px;padding:12px;border-top:1px solid var(--border)}
    .btn{flex:1;padding:10px;border-radius:8px;border:0;font-weight:700;cursor:pointer}
    .btn.primary{background:var(--blue);color:#121212;text-align:center}
    .btn.link{background:transparent;text-decoration:underline;color:var(--blue);flex:0}
    .table-wrap{overflow-x:auto;background:#1f1f1f;border-radius:12px;box-shadow:var(--shadow)}
    table{width:100%;border-collapse:collapse;min-width:900px}
    th,td{padding:12px;border-bottom:1px solid #333;text-align:left;color:var(--text-main)}
    th{background:#222;color:#eee;position:sticky;top:0}
    th.sortable{cursor:pointer;user-select:none}
    th.sortable .arrow{opacity:.6;margin-left:6px;font-size:12px}
    .pager{display:flex;gap:8px;align-items:center;justify-content:flex-end;margin-top:12px}
    .pager .btn{flex:0}
    @media (max-width:760px){.hero-inner{padding:32px 18px}.hero h1{font-size:28px}.controls{padding:14px}.nav{padding:10px 12px}}
  </style>
</head>
<body>
  <header class="nav" role="navigation" aria-label="主選單">
    <div class="brand">
      <div class="logo"><img src="./images/logo.png" alt="易居房 Logo"></div>
      <div><div style="font-weight:800">易居房EG City</div><div style="font-size:12px;color:var(--text-muted)">找房・比較・決策</div></div>
    </div>
    <nav class="nav-links">
      <a href="#/home" id="nav-home">首頁</a>
      <a href="#/buy" id="nav-buy">買屋</a>
      <a href="#/compare" id="nav-compare">比價</a>
      <a href="#/price" id="nav-price">實價登錄</a>
    </nav>
  </header>

  <main id="app" class="container" aria-live="polite">
    <noscript style="color:#fff">本網站需要啟用 JavaScript 才能運作</noscript>
  </main>

  <script>
    /* ---------------- 基礎工具 ---------------- */
    const $=(s,e=document)=>e.querySelector(s); const $$=(s,e=document)=>[...e.querySelectorAll(s)];
    const formatWan=(wan)=> (isFinite(wan)?wan.toLocaleString()+' 萬':String(wan));
    function setActiveNav(hash){ $$('#nav-home,#nav-buy,#nav-compare,#nav-price').forEach(a=>a.classList.remove('active')); 
      if(hash.startsWith('#/buy'))$('#nav-buy').classList.add('active');
      else if(hash.startsWith('#/compare'))$('#nav-compare').classList.add('active');
      else if(hash.startsWith('#/price'))$('#nav-price').classList.add('active');
      else $('#nav-home').classList.add('active'); }

    /* ---------------- 首頁：熱門物件（CSV） ---------------- */
    // 放在 data/hot_items.csv；欄位：物件超連結, 物件標題, 地址, 房屋類型, 目前價格
    const HOT_FILE = "hot_items.csv";
    const HOT_DATA = [
      "1_信義房屋_Kaohsiung_P20.csv",
      "1_信義房屋_Keelung_P20.csv",
      "1_信義房屋_NewTaipei_P20.csv",
      "1_信義房屋_Taichung_P20.csv",
      "1_信義房屋_Tainan_P20.csv",
      "1_信義房屋_Taipei_P19.csv",
      "1_信義房屋_Taoyuan_P19.csv",
    ]; // {id,url,title,address,type,priceWan}

    function parseCsv(text){
      const out=[], row=[], pushRow=()=>{ out.push([...row]); row.length=0; };
      let cell='', q=false; for(let i=0;i<text.length;i++){ const ch=text[i], nx=text[i+1];
        if(ch==='"'){ if(q&&nx==='"'){cell+='"';i++;} else q=!q; continue; }
        if(ch===',' && !q){ row.push(cell); cell=''; continue; }
        if((ch=== '\n' || ch=== '\r') && !q){ if(cell!==''||row.length){row.push(cell);cell='';pushRow();} if(ch==='\r'&&nx==='\n') i++; continue; }
        cell+=ch;
      } if(cell!==''||row.length){ row.push(cell); pushRow(); } return out;
    }
    function parsePriceWanFlexible(text){ if(text==null) return NaN; const t=String(text).trim(); const hasWan=t.includes('萬'); const digits=t.replace(/[^\d.]/g,''); const val=parseFloat(digits||'0'); if(!val) return NaN; if(hasWan) return val; if(val>1000000) return Math.round(val/10000); return val; }
    function hotRowToRecord(header,row){
      const map={}; header.forEach((h,i)=>map[String(h).trim()]=(row[i]??'').toString().trim());
      const url=map['物件超連結']||''; const title=map['物件標題']||''; const address=map['地址']||''; const type=map['房屋類型']||''; const priceWan=parsePriceWanFlexible(map['目前價格']);
      if(!title || !url) return null; return {url,title,address,type,priceWan};
    }
    async function loadHotCsvSilent(){
      if(HOT_DATA.length) return;
      try{
        const res = await fetch(`./data/${HOT_FILE}`); if(!res.ok) return;
        const text = await res.text(); const rows = parseCsv(text); const header = rows[0]?.map(h=>h.trim())||[]; const body = rows.slice(1);
        const items=[]; for(const r of body){ const rec=hotRowToRecord(header,r); if(rec) items.push(rec); }
        items.forEach((r,i)=>r.id=i+1); HOT_DATA.push(...items);
      }catch(e){ console.warn('熱門物件 CSV 載入失敗',e); }
    }
    function hotCard(item){
      return `<article class="card" aria-label="熱門物件">
        <div class="content">
          <div class="meta">
            <div><div style="font-weight:800">${item.title}</div><div class="tags">${item.address} • ${item.type}</div></div>
            <div class="price">NT$ ${formatWan(item.priceWan)}</div>
          </div>
        </div>
        <div class="actions"><a class="btn primary" href="${item.url}" target="_blank" rel="noopener">我要買</a></div>
      </article>`;
    }

    /* ---------------- 實價登錄（CSV 合併） ---------------- */
    const PRICE_DATA = [];
    const PRESET_FILES = [
      "114年第二季_台北.csv",
      "114年第二季_新北.csv",
      "114年第二季_桃園.csv",
      "114年第二季_台中.csv",
      "114年第二季_台南.csv",
      "114年第二季_高雄.csv",
      "114年第三季_台北.csv",
      "114年第三季_新北.csv",
      "114年第三季_桃園.csv",
      "114年第三季_台中.csv",
      "114年第三季_台南.csv",
      "114年第三季_高雄.csv"
    ];
    const priceState={sortKey:'date',sortDir:'desc',page:1,pageSize:100,filters:{}};
    function num(s){ if(s==null) return 0; return parseFloat(String(s).replace(/[\s,]/g,''))||0; }
    function toYearMonth(s){
      if(!s) return ''; const t=String(s).trim(); const roc=t.replace(/\D/g,'');
      if(roc.length===7||roc.length===8){ const y=1911+parseInt(roc.slice(0,3),10); const m=roc.slice(3,5); return `${y}-${m}`; }
      const m1=t.match(/^(\d{4})[-\/](\d{1,2})/); if(m1){ const y=m1[1]; const m=String(m1[2]).padStart(2,'0'); return `${y}-${m}`; }
      return '';
    }
    function buildYmToDate(s){
      if(!s) return null; const t=String(s).trim(); const m1=t.match(/^(\d{2,4})[-\/](\d{1,2})/);
      if(m1){ let y=parseInt(m1[1],10); const m=Math.min(12,Math.max(1,parseInt(m1[2],10))); if(m1[1].length<=3) y=1911+y; return new Date(y,m-1,1); }
      const digits=t.replace(/\D/g,''); if(/^\d{5,8}$/.test(digits)){ if(digits.length===7){ const yR=parseInt(digits.slice(0,3),10); const m=parseInt(digits.slice(3,5),10); return new Date(1911+yR,m-1,1); } if(digits.length===8){ const y=parseInt(digits.slice(0,4),10); const m=parseInt(digits.slice(4,6),10); return new Date(y,m-1,1); } }
      return null;
    }
    function calcAgeYears(d,now=new Date()){ if(!d||isNaN(d.getTime())) return 0; let y=now.getFullYear()-d.getFullYear(); if(now.getMonth()<d.getMonth()) y--; return Math.max(0,y); }
    function splitCityDist(addr){ if(!addr) return {city:'',district:'',road:''}; const s=String(addr);
      const m=s.match(/^(.*?[縣市])(.*?[區鄉鎮市])(.*)$/); if(m) return {city:m[1].trim(),district:m[2].trim(),road:m[3].trim()};
      const m2=s.match(/^(.*?[縣市])(.*)$/); if(m2) return {city:m2[1].trim(),district:'',road:m2[2].trim()}; return {city:'',district:'',road:s.trim()}; }
    function rowToRecord(header,row){
      const map={}; header.forEach((h,i)=>map[String(h).trim()]=(row[i]??'').toString().trim());
      const addr=map['土地位置建物門牌']||''; const tdate=map['交易年月日']||''; const type=map['建物型態']||map['交易標的']||'';
      const cityDist=splitCityDist(addr); const totalWan=num(map['總價元'])/10000;
      const unitWanPerPing=(num(map['單價元平方公尺'])*3.305785)/10000;
      const areaPing = num(map['建物移轉總面積平方公尺'])? num(map['建物移轉總面積平方公尺'])/3.305785 : 0;
      const age=calcAgeYears(buildYmToDate(map['建築完成年月']));
      const rec={id:undefined,date:toYearMonth(tdate),city:cityDist.city,district:map['鄉鎮市區']||cityDist.district,
        addr:cityDist.road||addr,type,areaPing:Number(areaPing.toFixed(2)),unitWanPerPing:Number(unitWanPerPing.toFixed(2)),totalWan:Math.round(totalWan),age};
      if(!rec.date) return null; if(!rec.city && !rec.district && !rec.addr) return null; return rec;
    }
    function csvTextToRecords(text){ const lines=parseCsv(text).filter(r=>r.length&&r.some(x=>x&&x.trim()!=='')); if(!lines.length) return []; const header=lines[0].map(h=>h.trim()); const body=lines.slice(1); const out=[]; for(const r of body){ const rec=rowToRecord(header,r); if(rec) out.push(rec);} return out; }
    function dedupRecords(arr){ const seen=new Set(),u=[]; for(const r of arr){ const k=[r.date,r.city,r.district,r.addr,r.areaPing,r.totalWan].join('|'); if(!seen.has(k)){seen.add(k);u.push(r);} } u.sort((a,b)=>a.date>b.date?-1:a.date<b.date?1:0); u.forEach((r,i)=>r.id=i+1); return u; }
    let PRICE_READY=false;
    async function autoLoadFromPresetSilent(){
      if(PRICE_READY) return; const base="./data/"; const texts=[];
      for(const name of PRESET_FILES){ try{ const res=await fetch(base+name); if(!res.ok) continue; texts.push(await res.text()); }catch(e){} }
      if(!texts.length){ console.warn('未載入任何實價 CSV'); return; }
      const all=[]; for(const t of texts) all.push(...csvTextToRecords(t)); const merged=dedupRecords(all);
      PRICE_DATA.length=0; PRICE_DATA.push(...merged); PRICE_READY=true;
    }
    function headerCell(key,label){ const arrow=priceState.sortKey===key?(priceState.sortDir==='asc'?'▲':'▼'):''; return `<th class="sortable" data-key="${key}">${label} <span class="arrow">${arrow}</span></th>`; }
    function getPriceFilters(){ return priceState.filters={
      city:($('#p-city')?.value||'').trim(),dist:($('#p-dist')?.value||'').trim(),type:$('#p-type')?.value||'',
      from:$('#p-from')?.value||'',to:$('#p-to')?.value||'',
      minTotal:Number($('#p-min-total')?.value)||0,maxTotal:Number($('#p-max-total')?.value)||Infinity,
      minUnit:Number($('#p-min-unit')?.value)||0,maxUnit:Number($('#p-max-unit')?.value)||Infinity}; }
    function applyPrice(){
      const f=getPriceFilters();
      let list=PRICE_DATA.filter(r=>{
        const okCity=!f.city||r.city.includes(f.city);
        const okDist=!f.dist||r.district.includes(f.dist);
        const okType=!f.type||r.type===f.type;
        const okFrom=!f.from||r.date>=f.from; const okTo=!f.to||r.date<=f.to;
        const okTotal=r.totalWan>=f.minTotal&&r.totalWan<=f.maxTotal;
        const okUnit=r.unitWanPerPing>=f.minUnit&&r.unitWanPerPing<=f.maxUnit;
        return okCity&&okDist&&okType&&okFrom&&okTo&&okTotal&&okUnit;
      });
      list.sort((a,b)=>{const k=priceState.sortKey; const dir=priceState.sortDir==='asc'?1:-1; return (a[k]>b[k]?1:a[k]<b[k]?-1:0)*dir;});
      renderPrice(list);
    }
    function renderPrice(list){
      const tbody=$('#price-tbody'); if(!tbody) return;
      const total=list.length; const pages=Math.max(1,Math.ceil(total/priceState.pageSize));
      priceState.page=Math.min(priceState.page,pages); const start=(priceState.page-1)*priceState.pageSize; const rows=list.slice(start,start+priceState.pageSize);
      tbody.innerHTML=rows.map(r=>`<tr>
        <td>${r.date}</td><td>${r.city}</td><td>${r.district}</td><td>${r.addr}</td>
        <td>${r.type}</td><td>${r.areaPing}</td><td>${r.unitWanPerPing}</td><td>${r.totalWan}</td><td>${r.age}</td>
      </tr>`).join('');
      const info=$('#price-info'); if(info) info.textContent=`共 ${total} 筆，頁 ${priceState.page}/${pages}`;
      $('#price-prev')?.addEventListener('click',()=>{ if(priceState.page>1){priceState.page--; applyPrice();} });
      $('#price-next')?.addEventListener('click',()=>{ if(priceState.page*priceState.pageSize<total){priceState.page++; applyPrice();} });
      $$('#price-table thead th.sortable').forEach(th=>{ th.onclick=()=>{ const key=th.dataset.key; if(priceState.sortKey===key){ priceState.sortDir=priceState.sortDir==='asc'?'desc':'asc'; } else { priceState.sortKey=key; priceState.sortDir='asc'; } $('#app').innerHTML=PagePrice(); bindPriceControls(); applyPrice(); }; });
    }
    function bindPriceControls(){
      $('#p-search')?.addEventListener('click',()=>{ priceState.page=1; applyPrice(); });
      $('#p-reset')?.addEventListener('click',()=>{ ['p-city','p-dist','p-type','p-from','p-to','p-min-total','p-max-total','p-min-unit','p-max-unit'].forEach(id=>{ const el=$('#'+id); if(el) el.value=''; }); priceState.page=1; priceState.sortKey='date'; priceState.sortDir='desc'; applyPrice(); });
    }

    /* ---------------- 首頁、買屋、比價 UI ---------------- */
    function Controls({showSort=false}){ return `
      <section class="controls" role="region" aria-label="篩選工具">
        <div class="field"><label for="search-city">地區搜尋</label><input id="search-city" type="text" placeholder="輸入城市或行政區"></div>
        <div class="field"><label>價格（萬）</label><div class="range-inline"><input id="min-price" type="number" placeholder="最低" min="0" style="width:120px"><input id="max-price" type="number" placeholder="最高" min="0" style="width:120px"></div></div>
        <div class="field"><label for="type">房屋型態</label><select id="type"><option value="">全部</option><option>公寓</option><option>住宅大樓</option><option>別墅</option><option>透天</option><option>店面</option><option>豪宅</option></select></div>
        ${showSort?`<div class="field"><label for="sort">排序</label><select id="sort"><option value="relevance">相關性</option><option value="price_asc">價格：低到高</option><option value="price_desc">價格：高到低</option></select></div>`:''}
        <div class="btns"><button id="btn-search" class="btn primary">搜尋</button><button id="btn-reset" class="btn link">重設</button></div>
      </section>`; }
    function PageHome(){
      const news=[{title:"地產天下",source:"自由時報",url:"https://estate.ltn.com.tw/"},{title:"房市即時",source:"工商時報",url:"https://www.ctee.com.tw/livenews/house"},{title:"591 房市新聞",source:"591",url:"https://news.591.com.tw/"}]
        .map(n=>`<tr><td>${n.title}</td><td>${n.source}</td><td><a class="btn link" href="${n.url}" target="_blank" rel="noopener">查看</a></td></tr>`).join('');
      return `
        <section class="hero" aria-label="主視覺"><div class="hero-inner"><h1>找到你理想的家</h1><p>依地區、價格與房型快速篩選，並提供詳細資訊與比較功能。</p><a class="cta" href="#/buy">我要找房</a></div></section>
        ${Controls({showSort:true})}
        <section><h2 class="section-title">熱門物件</h2><div id="hot-grid" class="grid"><div class="card"><div class="content"><div class="tags">載入中…</div></div></div></div></section>
        <section style="margin-top:28px;"><h2 class="section-title">即時新聞</h2><div class="table-wrap"><table aria-label="房市新聞"><thead><tr><th style="width:60%">標題</th><th>來源</th><th>連結</th></tr></thead><tbody>${news}</tbody></table></div></section>
      `;
    }
    function renderHotIntoHome(){ const grid=$('#hot-grid'); if(!grid) return; if(!HOT_DATA.length){ grid.innerHTML=`<div class="card"><div class="content"><div class="tags">目前沒有資料</div></div></div>`; return; } grid.innerHTML=HOT_DATA.slice(0,12).map(hotCard).join(''); }

    function PageBuy(){ return `<h2 class="section-title">待售房屋</h2>${Controls({showSort:true})}<div id="no-results" style="display:none;margin-top:18px;color:var(--text-muted)">沒有符合條件的房源。</div><div id="grid" class="grid" aria-live="polite"></div>`; }
    const DATA=[]; // 此頁暫留（可接你日後的待售來源）
    function getFilters(){ return { city:($('#search-city')?.value||'').trim().toLowerCase(), minPrice:Number($('#min-price')?.value)||0, maxPrice:Number($('#max-price')?.value)||Infinity, type:$('#type')?.value||'', sort:$('#sort')?.value||'relevance' }; }
    function applyFilters(){ const grid=$('#grid'); if(!grid) return; const f=getFilters(); let results=DATA.filter(d=>{ const mCity=!f.city||d.city.toLowerCase().includes(f.city); const mType=!f.type||d.type===f.type; const mPrice=d.priceWan>=f.minPrice&&d.priceWan<=f.maxPrice; return mCity&&mType&&mPrice;}); if(f.sort==='price_asc') results.sort((a,b)=>a.priceWan-b.priceWan); else if(f.sort==='price_desc') results.sort((a,b)=>b.priceWan-a.priceWan); renderList(results); }
    function renderList(items){ const grid=$('#grid'), empty=$('#no-results'); if(!grid) return; grid.innerHTML=''; if(!items.length){ if(empty) empty.style.display='block'; return; } else if(empty){ empty.style.display='none'; } grid.innerHTML=items.map(d=>`<article class="card"><div class="content"><div class="meta"><div><div style="font-weight:800">${d.title}</div><div class="tags">${d.city} • ${d.type}</div></div><div class="price">NT$ ${formatWan(d.priceWan)}</div></div><div class="desc">${d.desc||''}</div></div></article>`).join(''); }

    function PageCompare(){ return `<h2 class="section-title">房屋比價</h2><div class="table-wrap"><table><thead><tr><th>目前尚未接資料</th></tr></thead></table></div>`; }

    /* ---------------- 實價登錄頁 ---------------- */
    function ControlsPrice(){ return `
      <section class="controls" role="region" aria-label="實價篩選">
        <div class="field"><label>城市</label><input id="p-city" type="text" placeholder="例如：台北市"></div>
        <div class="field"><label>行政區</label><input id="p-dist" type="text" placeholder="例如：大安區"></div>
        <div class="field"><label>型態</label><select id="p-type"><option value="">全部</option><option>住宅大樓</option><option>公寓</option><option>透天</option><option>華夏</option></select></div>
        <div class="field"><label>成交月(起)</label><input id="p-from" type="month"></div>
        <div class="field"><label>成交月(迄)</label><input id="p-to" type="month"></div>
        <div class="field"><label>總價(萬)</label><div class="range-inline"><input id="p-min-total" type="number" placeholder="最低" min="0" style="width:120px"><input id="p-max-total" type="number" placeholder="最高" min="0" style="width:120px"></div></div>
        <div class="field"><label>單價(萬/坪)</label><div class="range-inline"><input id="p-min-unit" type="number" placeholder="最低" min="0" style="width:120px"><input id="p-max-unit" type="number" placeholder="最高" min="0" style="width:120px"></div></div>
        <div class="btns"><button id="p-search" class="btn primary">搜尋</button><button id="p-reset" class="btn link">重設</button></div>
      </section>`; }
    function PagePrice(){ return `
      <h2 class="section-title">實價登錄</h2>
      ${ControlsPrice()}
      <div class="table-wrap"><table aria-label="實價表" id="price-table"><thead><tr>
        ${headerCell('date','成交月')}${headerCell('city','城市')}${headerCell('district','行政區')}${headerCell('addr','路段')}
        ${headerCell('type','型態')}${headerCell('areaPing','建坪(坪)')}${headerCell('unitWanPerPing','單價(萬/坪)')}${headerCell('totalWan','總價(萬)')}${headerCell('age','屋齡')}
      </tr></thead><tbody id="price-tbody"></tbody></table></div>
      <div class="pager"><span id="price-info" style="margin-right:auto"></span><button class="btn link" id="price-prev">上一頁</button><button class="btn primary" id="price-next">下一頁</button></div>
    `; }

    /* ---------------- Router ---------------- */
    function route(hash){ window.location.hash = hash; }
    function renderRoute(){
      const h = window.location.hash || '#/home'; setActiveNav(h); const app = $('#app');
      if(h.startsWith('#/buy')){ app.innerHTML=PageBuy(); $('#btn-search')?.addEventListener('click',applyFilters); $('#btn-reset')?.addEventListener('click',()=>{ $('#search-city').value=''; $('#min-price').value=''; $('#max-price').value=''; $('#type').value=''; $('#sort').value='relevance'; renderList(DATA); }); renderList(DATA); }
      else if(h.startsWith('#/compare')){ app.innerHTML=PageCompare(); }
      else if(h.startsWith('#/price')){ app.innerHTML=PagePrice(); bindPriceControls(); autoLoadFromPresetSilent().then(applyPrice); }
      else { app.innerHTML=PageHome(); loadHotCsvSilent().then(renderHotIntoHome);
        $('#btn-search')?.addEventListener('click',()=>{ const p=new URLSearchParams({city:$('#search-city').value||'',min:$('#min-price').value||'',max:$('#max-price').value||'',type:$('#type').value||'',sort:$('#sort').value||'relevance'}); route('#/buy?'+p.toString()); });
        $('#btn-reset')?.addEventListener('click',()=>{ $('#search-city').value=''; $('#min-price').value=''; $('#max-price').value=''; $('#type').value=''; $('#sort').value='relevance'; });
      }
      // 帶查詢條件導入買屋
      if(h.startsWith('#/buy')){ const q=h.split('?')[1]; if(q){ const p=new URLSearchParams(q); if($('#search-city')) $('#search-city').value=p.get('city')||''; if($('#min-price')) $('#min-price').value=p.get('min')||''; if($('#max-price')) $('#max-price').value=p.get('max')||''; if($('#type')) $('#type').value=p.get('type')||''; if($('#sort')) $('#sort').value=p.get('sort')||'relevance'; applyFilters(); } }
    }
    window.addEventListener('hashchange',renderRoute);
    window.addEventListener('DOMContentLoaded',renderRoute);
  </script>
</body>
</html>

